/********************************************************************************
 *                              Apache License									
 *                           Version 2.0, January 2004							
 *                        http://www.apache.org/licenses/						
 *																				
 *   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION				
 *																				
 *   1. Definitions.															
 *																				
 *      "License" shall mean the terms and conditions for use, reproduction,	
 *      and distribution as defined by Sections 1 through 9 of this document.	
 *																				
 *      "Licensor" shall mean the copyright owner or entity authorized by		
 *      the copyright owner that is granting the License.						
 *																				
 *      "Legal Entity" shall mean the union of the acting entity and all		
 *      other entities that control, are controlled by, or are under common		
 *      control with that entity. For the purposes of this definition,			
 *      "control" means (i) the power, direct or indirect, to cause the			
 *      direction or management of such entity, whether by contract or			
 *      otherwise, or (ii) ownership of fifty percent (50%) or more of the		
 *      outstanding shares, or (iii) beneficial ownership of such entity.		
 *																				
 *      "You" (or "Your") shall mean an individual or Legal Entity				
 *      exercising permissions granted by this License.							
 *																				
 *      "Source" form shall mean the preferred form for making modifications,	
 *      including but not limited to software source code, documentation		
 *      source, and configuration files.										
 *																				
 *      "Object" form shall mean any form resulting from mechanical				
 *      transformation or translation of a Source form, including but			
 *      not limited to compiled object code, generated documentation,			
 *      and conversions to other media types.									
 *																				
 *      "Work" shall mean the work of authorship, whether in Source or			
 *      Object form, made available under the License, as indicated by a		
 *      copyright notice that is included in or attached to the work			
 *      (an example is provided in the Appendix below).							
 *																				
 *      "Derivative Works" shall mean any work, whether in Source or Object		
 *      form, that is based on (or derived from) the Work and for which the		
 *      editorial revisions, annotations, elaborations, or other modifications	
 *      represent, as a whole, an original work of authorship. For the purposes	
 *      of this License, Derivative Works shall not include works that remain	
 *      separable from, or merely link (or bind by name) to the interfaces of,	
 *      the Work and Derivative Works thereof.									
 *																				
 *      "Contribution" shall mean any work of authorship, including				
 *      the original version of the Work and any modifications or additions		
 *      to that Work or Derivative Works thereof, that is intentionally			
 *      submitted to Licensor for inclusion in the Work by the copyright owner	
 *      or by an individual or Legal Entity authorized to submit on behalf of	
 *      the copyright owner. For the purposes of this definition, "submitted"	
 *      means any form of electronic, verbal, or written communication sent		
 *      to the Licensor or its representatives, including but not limited to	
 *      communication on electronic mailing lists, source code control systems,	
 *      and issue tracking systems that are managed by, or on behalf of, the	
 *      Licensor for the purpose of discussing and improving the Work, but		
 *      excluding communication that is conspicuously marked or otherwise		
 *      designated in writing by the copyright owner as "Not a Contribution."	
 *																				
 *      "Contributor" shall mean Licensor and any individual or Legal Entity	
 *      on behalf of whom a Contribution has been received by Licensor and		
 *      subsequently incorporated within the Work.								
 *																				
 *   2. Grant of Copyright License. Subject to the terms and conditions of		
 *      this License, each Contributor hereby grants to You a perpetual,		
 *      worldwide, non-exclusive, no-charge, royalty-free, irrevocable			
 *      copyright license to reproduce, prepare Derivative Works of,			
 *      publicly display, publicly perform, sublicense, and distribute the		
 *      Work and such Derivative Works in Source or Object form.				
 *																				
 *   3. Grant of Patent License. Subject to the terms and conditions of			
 *      this License, each Contributor hereby grants to You a perpetual,		
 *      worldwide, non-exclusive, no-charge, royalty-free, irrevocable			
 *      (except as stated in this section) patent license to make, have made,	
 *      use, offer to sell, sell, import, and otherwise transfer the Work,		
 *      where such license applies only to those patent claims licensable		
 *      by such Contributor that are necessarily infringed by their				
 *      Contribution(s) alone or by combination of their Contribution(s)		
 *      with the Work to which such Contribution(s) was submitted. If You		
 *      institute patent litigation against any entity (including a				
 *      cross-claim or counterclaim in a lawsuit) alleging that the Work		
 *      or a Contribution incorporated within the Work constitutes direct		
 *      or contributory patent infringement, then any patent licenses			
 *      granted to You under this License for that Work shall terminate			
 *      as of the date such litigation is filed.								
 *																				
 *   4. Redistribution. You may reproduce and distribute copies of the			
 *      Work or Derivative Works thereof in any medium, with or without			
 *      modifications, and in Source or Object form, provided that You			
 *      meet the following conditions:											
 *																				
 *      (a) You must give any other recipients of the Work or					
 *          Derivative Works a copy of this License; and						
 *																				
 *      (b) You must cause any modified files to carry prominent notices		
 *          stating that You changed the files; and								
 *																				
 *      (c) You must retain, in the Source form of any Derivative Works			
 *          that You distribute, all copyright, patent, trademark, and			
 *          attribution notices from the Source form of the Work,				
 *          excluding those notices that do not pertain to any part of			
 *          the Derivative Works; and											
 *																				
 *      (d) If the Work includes a "NOTICE" text file as part of its			
 *          distribution, then any Derivative Works that You distribute must	
 *          include a readable copy of the attribution notices contained		
 *          within such NOTICE file, excluding those notices that do not		
 *          pertain to any part of the Derivative Works, in at least one		
 *          of the following places: within a NOTICE text file distributed		
 *          as part of the Derivative Works; within the Source form or			
 *          documentation, if provided along with the Derivative Works; or,		
 *          within a display generated by the Derivative Works, if and			
 *          wherever such third-party notices normally appear. The contents		
 *          of the NOTICE file are for informational purposes only and			
 *          do not modify the License. You may add Your own attribution			
 *          notices within Derivative Works that You distribute, alongside		
 *          or as an addendum to the NOTICE text from the Work, provided		
 *          that such additional attribution notices cannot be construed		
 *          as modifying the License.											
 *																				
 *      You may add Your own copyright statement to Your modifications and		
 *      may provide additional or different license terms and conditions		
 *      for use, reproduction, or distribution of Your modifications, or		
 *      for any such Derivative Works as a whole, provided Your use,			
 *      reproduction, and distribution of the Work otherwise complies with		
 *      the conditions stated in this License.									
 *																				
 *   5. Submission of Contributions. Unless You explicitly state otherwise,		
 *      any Contribution intentionally submitted for inclusion in the Work		
 *      by You to the Licensor shall be under the terms and conditions of		
 *      this License, without any additional terms or conditions.				
 *      Notwithstanding the above, nothing herein shall supersede or modify		
 *      the terms of any separate license agreement you may have executed		
 *      with Licensor regarding such Contributions.								
 *																				
 *   6. Trademarks. This License does not grant permission to use the trade		
 *      names, trademarks, service marks, or product names of the Licensor,		
 *      except as required for reasonable and customary use in describing the	
 *      origin of the Work and reproducing the content of the NOTICE file.		
 *																				
 *   7. Disclaimer of Warranty. Unless required by applicable law or			
 *      agreed to in writing, Licensor provides the Work (and each				
 *      Contributor provides its Contributions) on an "AS IS" BASIS,			
 *      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or			
 *      implied, including, without limitation, any warranties or conditions	
 *      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A			
 *      PARTICULAR PURPOSE. You are solely responsible for determining the		
 *      appropriateness of using or redistributing the Work and assume any		
 *      risks associated with Your exercise of permissions under this License.	
 *																				
 *   8. Limitation of Liability. In no event and under no legal theory,			
 *      whether in tort (including negligence), contract, or otherwise,			
 *      unless required by applicable law (such as deliberate and grossly		
 *      negligent acts) or agreed to in writing, shall any Contributor be		
 *      liable to You for damages, including any direct, indirect, special,		
 *      incidental, or consequential damages of any character arising as a		
 *      result of this License or out of the use or inability to use the		
 *      Work (including but not limited to damages for loss of goodwill,		
 *      work stoppage, computer failure or malfunction, or any and all			
 *      other commercial damages or losses), even if such Contributor			
 *      has been advised of the possibility of such damages.					
 *																				
 *   9. Accepting Warranty or Additional Liability. While redistributing		
 *      the Work or Derivative Works thereof, You may choose to offer,			
 *      and charge a fee for, acceptance of support, warranty, indemnity,		
 *      or other liability obligations and/or rights consistent with this		
 *      License. However, in accepting such obligations, You may act only		
 *      on Your own behalf and on Your sole responsibility, not on behalf		
 *      of any other Contributor, and only if You agree to indemnify,			
 *      defend, and hold each Contributor harmless for any liability			
 *      incurred by, or claims asserted against, such Contributor by reason		
 *      of your accepting any such warranty or additional liability.			
 *																				
 *   END OF TERMS AND CONDITIONS																		
 *																				
 *   Copyright (c) 2019 Ali El Saleh	GitHub(@AliElSaleh) or (http://alielsaleh.com)
 *																				
 *   Licensed under the Apache License, Version 2.0 (the "License");			
 *   you may not use this file except in compliance with the License.			
 *   You may obtain a copy of the License at									
 *																				
 *       http://www.apache.org/licenses/LICENSE-2.0								
 *																				
 *   Unless required by applicable law or agreed to in writing, software		
 *   distributed under the License is distributed on an "AS IS" BASIS,			
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.	
 *   See the License for the specific language governing permissions and		
 *   limitations under the License.
 *   
 *********************************************************************************/

#pragma once
#include "raylib.h"

// Animator for Raylib is a simple tool used to animate sprite-sheets.
class Animator
{
public:
	/// <summary>Creates an animator instance.</summary>
	/// <param name="AnimatorName">A name the animator will be identified by.</param>
	/// <param name="NumOfFramesPerRow">The amount of frames/columns in a row.</param>
	/// <param name="NumOfRows">The amount of rows in the sprite sheet.</param>
	/// <param name="Speed">The animation speed in frames per second.</param>
	/// <param name="bPlayInReverse">Should the animator play the sprite in reverse play mode?</param>
	/// <param name="bContinuous">Should the animator automatically go to the next row in the sprite sheet?</param>
	/// <param name="bLooping">Should the animator loop indefinitely?</param>
	Animator(const char* AnimatorName, unsigned int NumOfFramesPerRow, unsigned int NumOfRows, unsigned int Speed, bool bPlayInReverse = false, bool bContinuous = false, bool bLooping = true);

	~Animator() = default;

	/// <summary>Assigns a sprite for the animator to use. (This should be called once)</summary>
	/// <param name="Sprite">The sprite the animator will use.</param>
	void AssignSprite(const Texture2D& Sprite);

	/// <summary>Changes the sprite the animator is using.</summary>
	/// <param name="NewSprite">The new sprite the animator will change to. Will reset to beginning frame.</param>
	/// <param name="NumOfFramesPerRow">The amount of frames/columns in a row.</param>
	/// <param name="NumOfRows">The amount of rows in the sprite sheet.</param>
	/// <param name="Speed">The animation speed in frames per second.</param>
	/// <param name="DelayInSeconds">The amount of time (in seconds) to change to the new sprite. A value of 0.0f is instant/no delay.</param>
	/// <param name="bPlayInReverse">Should the animator play the new sprite in reverse play mode?</param>
	/// <param name="bContinuous">Should the animator automatically go to the next row in the sprite sheet?</param>
	/// <param name="bLooping">Should the animator loop indefinitely?</param>
	void ChangeSprite(const Texture2D& NewSprite, unsigned int NumOfFramesPerRow, unsigned int NumOfRows, unsigned int Speed, float DelayInSeconds = 0.0f, bool bPlayInReverse = false, bool bContinuous = false, bool bLooping = true);

	/// <summary>Flips the sprite-sheet horizontally or vertically, or both.</summary>
	/// <param name="bHorizontalFlip">Flips the sprite sheet horizontally. DOES NOT WORK, set this to false.</param>
	/// <param name="bVerticalFlip">Flips the sprite sheet vertically.</param>
	void FlipSprite(bool bHorizontalFlip, bool bVerticalFlip = true);
	
	/// <summary>Set whether the animator should loop or not.</summary>
	/// <param name="bLooping">Should the animator loop?</param>
	void SetLooping(bool bLooping);

	/// <summary>Set whether the animator should go to the next row in the sprite sheet or not.</summary>
	/// <param name="bIsContinuous">Should the animator continue to the next row?</param>
	void SetContinuous(bool bIsContinuous);

	/// <summary>Set a new framerate the animator will use.</summary>
	/// <param name="NewFramerate">The new speed of animation.</param>
	void SetFramerate(unsigned int NewFramerate);

	/// <summary>Jump to a frame in the sprite-sheet.</summary>
	/// <param name="FrameNumber">The frame number in the sprite sheet. (Zero-based)</param>
	void GoToFrame(unsigned int FrameNumber);

	/// <summary>Jump to a row in the sprite-sheet.</summary>
	/// <param name="RowNumber">The row number in the sprite sheet. (Zero-based)</param>
	void GoToRow(unsigned int RowNumber);

	/// <summary>Jump to a column in the current row.</summary>
	/// <param name="ColumnNumber">The column number in the sprite sheet. (Zero-based)</param>
	void GoToColumn(unsigned int ColumnNumber);

	/// Jump to the first row.
	void GoToFirstRow();

	/// Jump to the first column.
	void GoToFirstColumn();

	/// Jump to the last row.
	void GoToLastRow();

	/// Jump to the last column.
	void GoToLastColumn();

	/// Jump to the first frame in the current row.
	void GoToFirstFrame();

	/// Jump to the last frame in the current row.
	void GoToLastFrame();

	/// Jump to the first frame in the sprite sheet.
	void GoToFirstFrameOfSpriteSheet();

	/// Jump to the last frame in the sprite sheet.
	void GoToLastFrameOfSpriteSheet();

	/// Jump to the next row index.
	void NextRow();

	/// Jump to the previous row index.
	void PreviousRow();

	/// Jump to the next column index.
	void NextColumn();

	/// Jump to the previous column index.
	void PreviousColumn();

	/// Play animation from the current frame.
	void Play();

	/// Start the animation when it has been paused or has been stopped.
	void Start();

	/// Stop the animation from playing.
	void Stop();

	/// <summary>Pause the animation.</summary>
	/// <param name="bToggle">If true, flip-flop between pausing and un-pausing the animation every time when called. If false, pause the animation. You need to call UnPause to start the animation again.</param>
	void Pause(bool bToggle = false);

	/// UnPause the animation. (Start playing)
	void UnPause();

	/// Set the play mode to forward.
	void Forward();

	/// <summary>Set the play mode to reverse.</summary>
	/// <param name="bToggle">If true, flip-flop between reversing and un-reversing the play mode every time when called. If false, reverse the play mode. You need to call Forward to un-reverse.</param>
	void Reverse(bool bToggle = false);
	
	/// Restart the animation from the beginning.
	void Restart();

	/// <returns>The total amount of frames in the sprite-sheet.</returns>
	unsigned int GetTotalFrames() const;

	/// <returns>The total rows in the sprite-sheet.</returns>
	unsigned int GetTotalRows() const;

	/// <returns>The total columns per row.</returns>
	unsigned int GetTotalColumns() const;

	/// <returns>The current frame the animator is on. (Zero based)</returns>
	unsigned int GetCurrentFrame() const;

	/// <returns>The current row the animator is on. (Zero based)</returns>
	unsigned int GetCurrentRow() const;

	/// <returns>The current column the animator is on. (Zero based)</returns>
	unsigned int GetCurrentColumn() const;

	/// <returns>The total time animation will take to finish in frames.</returns>
	unsigned int GetTotalTimeInFrames() const;

	/// <returns>The time remaining in frames.</returns>
	unsigned int GetTimeRemainingInFrames() const;

	/// <returns>The total time animation will take to finish in seconds.</returns>
	float GetTotalTimeInSeconds() const;

	/// <returns>The time remaining in seconds.</returns>
	float GetTimeRemainingInSeconds() const;

	/// <returns>The name of the animator.</returns>
	const char* GetName() const;

	/// <summary>Is the animator currently on the frame number specified?</summary>
	/// <param name="FrameNumber">The frame number to query. (Zero based)</param>
	/// <returns>If the animator is on the frame number specified, true. Otherwise, false.</returns>
	bool IsAtFrame(unsigned int FrameNumber) const;

	/// <summary>Is the animator currently on the row number specified?</summary>
	/// <param name="RowNumber">The row number to query. (Zero based)</param>
	/// <returns>If the animator is on the row number specified, true. Otherwise, false.</returns>
	bool IsAtRow(unsigned int RowNumber) const;

	/// <summary>Is the animator currently on the column number specified?</summary>
	/// <param name="ColumnNumber">The column number to query. (Zero based)</param>
	/// <returns>If the animator is on the column number specified, true. Otherwise, false.</returns>
	bool IsAtColumn(unsigned int ColumnNumber) const;

	/// <summary>Is the animator currently on the first frame of the sprite-sheet?</summary>
	/// <returns>If the animator is on the first frame of the sprite-sheet, true. Otherwise, false.</returns>
	bool IsAtFirstFrameOfSpriteSheet() const;

	/// <summary>Is the animator currently on the last frame of the sprite-sheet?</summary>
	/// <returns>If the animator is on the last frame of the sprite-sheet, true. Otherwise, false.</returns>
	bool IsAtLastFrameOfSpriteSheet() const;

	/// <summary>Is the animator currently on the first frame of a current row?</summary>
	/// <returns>If the animator is on the first frame, true. Otherwise, false.</returns>
	bool IsAtFirstFrame() const;

	/// <summary>Is the animator currently on the last frame of a current row?</summary>
	/// <returns>If the animator is on the last frame, true. Otherwise, false.</returns>
	bool IsAtLastFrame() const;

	/// <summary>Is the animator currently on the first row of the sprite-sheet?</summary>
	/// <returns>If the animator is on the first row, true. Otherwise, false.</returns>
	bool IsAtFirstRow() const;

	/// <summary>Is the animator currently on the first column of a current row?</summary>
	/// <returns>If the animator is on the first column, true. Otherwise, false.</returns>
	bool IsAtFirstColumn() const;

	/// <summary>Is the animator currently on the last row of the sprite-sheet?</summary>
	/// <returns>If the animator is on the last row, true. Otherwise, false.</returns>
	bool IsAtLastRow() const;

	/// <summary>Is the animator currently on the last column of a current row?</summary>
	/// <returns>If the animator is on the last column, true. Otherwise, false.</returns>
	bool IsAtLastColumn() const;

	/// <summary>Is the animator currently playing?</summary>
	/// <returns>If the animator is currently playing, true. Otherwise, false.</returns>
	bool IsPlaying() const;

	/// <summary>Has the animator started playing?</summary>
	/// <returns>If the animator started playing, true. Otherwise, false.</returns>
	bool IsStartedPlaying();

	/// <summary>Has the animator finished playing?</summary>
	/// <returns>If the animator has animator finished playing, true. Otherwise, false.</returns>
	bool IsFinishedPlaying();

	/// <returns>The Frame rectangle. (Used for drawing the sprite)</returns>
	Rectangle GetFrameRec() const;

	/// <returns>The sprite texture.</returns>
	Texture2D GetSprite() const;

private:
	/// Counts down in frames. Used for timing functionality.
	void CountdownInFrames();

	/// Resets the timer to beginning.
	void ResetTimer();

	/// Resets the frame rectangle properties.
	void ResetFrameRec();

	/// Jumps to the next frame in the sprite-sheet.
	void NextFrame();

	/// Jumps to the previous frame in the sprite-sheet.
	void PreviousFrame();

	/// Sprite width / Total columns per row
	float FrameWidth{};

	/// Sprite height / Total rows
	float FrameHeight{};

	/// Used for timing.
	float TimeRemainingFramesCounter{};

	/// Used for querying how many frames have passed.
	unsigned int PlaybackPosition;

	/// Used for changing sprite if the delay parameter is used in ChangeSprite() function.
	unsigned int DelayFramesCounter;

	/// Total amount of rows.
	unsigned int Rows;

	/// Total amount of columns.
	unsigned int Columns;

	/// Speed of animation.
	unsigned int Framerate;

	/// The current row the animator is on. (Zero based)
	unsigned int CurrentRow;

	/// The current column the animator is on. (Zero based)
	unsigned int CurrentColumn;

	/// The current frame the animator is on. (Zero based)
	unsigned int CurrentFrame;

	/// Should flip the sprite horizontally?
	bool bFlipH{};

	/// Should flip the sprite vertically?
	bool bFlipV{};

	/// Used to query whether the animator is looping or not.
	bool bCanLoop;

	/// Used to query whether the animator is in reverse mode or not.
	bool bReverse{};

	/// Used to query whether the animator should go to the next row in the sprite-sheet.
	bool bContinuous{};

	/// Used to query whether the animator is paused or not.
	bool bPaused{};

	/// Used to query whether the animator is finished playing or not.
	bool bIsAnimationFinished{};

	/// Used to query whether the animator has started playing or not.
	bool bHasStartedPlaying{};

	/// The frame rectangle is used to draw only a part of the whole sprite-sheet
	Rectangle FrameRec{};

	/// The sprite the animator is using
	Texture2D Sprite{};
	
	/// The name of this animator
	const char* Name{};
};
